@model DLDA.GUI.DTOs.StaffResultOverviewDto

<div class="container mt-5">
    <h2>Sammanställning av personalens bedömning</h2>

    

    @{
        var countMatch = Model.Questions.Count(q => q.Difference == 0);
        var countMinor = Model.Questions.Count(q => q.Difference == 1 && !q.SkippedByPatient);
        var countMajor = Model.Questions.Count(q => q.Difference > 1);
        var countSkipped = Model.Questions.Count(q => q.SkippedByPatient);
    }

    <div class="mt-3">
        <h5>Sammanfattning</h5>
        <ul>
            <li><span class="badge bg-success">Grön:</span> Matchande svar: <strong>@countMatch</strong></li>
            <li><span class="badge bg-warning text-dark">Gul:</span> Viss skillnad (1 steg): <strong>@countMinor</strong></li>
            <li><span class="badge bg-danger">Röd:</span> Tydlig skillnad (>1 steg): <strong>@countMajor</strong></li>
            <li><span class="badge bg-danger">Röd:</span> Patient hoppade över: <strong>@countSkipped</strong></li>
        </ul>
    </div>


    <p><strong>Bedömning ID:</strong> @Model.AssessmentId</p>
    <p><strong>Patient:</strong> @Model.Username</p>
    <p><strong>Datum:</strong> @Model.CreatedAt.ToString("yyyy-MM-dd")</p>

    <table class="table table-bordered">
        <thead class="table-light">
            <tr>
                <th>#</th>
                <th>Fråga</th>
                <th>Patientens svar</th>
                <th>Personalens svar</th>
                <th>Skillnad</th>
                <th>Flagga</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var q in Model.Questions.OrderBy(q => q.Order))
            {
                <tr class="@GetRowColor(q.Difference, q.SkippedByPatient)">
                    <td>@(q.Order + 1)</td>
                    <td>@q.QuestionText</td>
                    <td>@(q.PatientAnswer?.ToString() ?? "Ej besvarad")</td>
                    <td>@(q.StaffAnswer?.ToString() ?? "Ej besvarad")</td>
                    <td>@(q.Difference >= 0 ? q.Difference.ToString() : "-")</td>
                    <td>@(q.Flag ? "⚠️" : "")</td>
                </tr>
            }
        </tbody>
    </table>

    <div class="mt-4 d-flex gap-3">
        <a class="btn btn-secondary" asp-controller="StaffAssessment" asp-action="Assessments" asp-route-userId="@Model.UserId">Tillbaka till Bedömningar</a>
    </div>
</div>

@functions {
    string GetRowColor(int difference, bool skipped)
    {
        if (skipped) return "table-danger"; // 🔴 Överhoppade frågor = röd
        if (difference == 0) return "table-success"; // 🟢 Matchande
        if (difference == 1) return "table-warning"; // 🟡 Liten skillnad
        if (difference > 1) return "table-danger";   // 🔴 Stor skillnad
        return "";
    }
}


